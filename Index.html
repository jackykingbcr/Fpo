<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Baccarat Sniper Max v7.0</title>
    <style>
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --text: #ffffff;
            --accent: #ffd700;
            --win: #32d74b;
            --loss: #ff453a;
            --border: #333;
            --banker-bg: #ff453a;
            --player-bg: #0a84ff;
            --wait-bg: #555555;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
            height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        #loginLayer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .login-box { width: 80%; max-width: 300px; text-align: center; }
        .login-input {
            width: 100%; padding: 12px; margin: 8px 0;
            background: #222; border: 1px solid #444; color: #fff;
            border-radius: 8px; box-sizing: border-box; font-size: 16px;
        }
        .login-btn {
            width: 100%; padding: 12px; background: var(--accent);
            color: #000; font-weight: bold; border: none;
            border-radius: 8px; font-size: 16px; margin-top: 10px;
        }

        #appLayer { display: none; height: 100%; flex-direction: column; }

        .header {
            padding: 10px 15px; background: #111;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border);
        }
        .app-title { font-weight: 800; font-size: 14px; color: #aaa; letter-spacing: 0.5px; }
        .btn-group-top { display: flex; gap: 8px; }
        .btn-small {
            background: #333; color: #ccc; border: none;
            padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: bold;
        }
        .btn-save { color: var(--accent); }
        .btn-reset { color: var(--loss); }

        .dashboard { padding: 10px; background: var(--card); flex-shrink: 0; }
        .pl-display-area { text-align: center; padding: 5px 0 10px 0; }
        .pl-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .pl-value { font-size: 36px; font-weight: 900; font-family: monospace; line-height: 1.1; }
        
        .comm-row { text-align: center; font-size: 12px; color: #666; margin-bottom: 10px; }
        .comm-val { color: #888; font-weight: bold; }

        .cum-scores-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 15px; }
        .cum-item { 
            background: #2c2c2e; border-radius: 8px; padding: 6px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .cum-label { font-size: 12px; color: #aaa; margin-bottom: 2px; font-weight: bold; }
        .cum-val-box { display: flex; align-items: baseline; gap: 3px; }
        .cum-val { font-size: 16px; font-weight: bold; }
        .cum-rate { font-size: 10px; color: #888; }

        .reg-progress-area { margin-bottom: 8px; padding: 0 4px; }
        .reg-label-row { display: flex; justify-content: space-between; font-size: 10px; color: #888; margin-bottom: 4px; font-weight: bold; }
        .reg-bar-bg { height: 6px; background: #333; border-radius: 3px; overflow: hidden; border: 1px solid #444; }
        .reg-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent) 0%, var(--win) 100%); box-shadow: 0 0 8px rgba(50, 215, 75, 0.2); transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

        .instr-card {
            background: linear-gradient(135deg, #3a3a3c, #2c2c2e);
            border: 1px solid #444; border-radius: 12px;
            padding: 15px; text-align: center; margin-bottom: 10px;
        }
        .phase-text { font-size: 12px; color: #aaa; margin-bottom: 5px; }
        .main-instr { font-size: 28px; font-weight: 900; line-height: 1.2; display: flex; justify-content: center; align-items: baseline; gap: 10px; }
        
        .wl-container {
            background: #111; border: 1px solid #333; border-radius: 8px;
            padding: 10px; margin-bottom: 10px;
        }
        .wl-stats {
            font-size: 11px; color: #888; margin-bottom: 6px;
            border-bottom: 1px solid #222; padding-bottom: 4px;
            display: flex; justify-content: space-between;
        }
        .wl-list {
            display: flex; flex-wrap: wrap; gap: 4px; font-size: 14px;
            min-height: 20px; max-height: 60px; overflow-y: auto;
            align-content: flex-start;
        }
        .wl-item-win { color: var(--win); }
        .wl-item-loss { color: var(--loss); }

        .side-B { color: var(--banker-bg); }
        .side-P { color: var(--player-bg); }
        .side-Wait { color: #888; }

        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-big {
            padding: 18px; border: none; border-radius: 10px;
            font-size: 20px; font-weight: bold; color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            transition: transform 0.1s;
            cursor: pointer;
        }
        .bg-b { background: var(--banker-bg); }
        .bg-p { background: var(--player-bg); }
        .btn-big:active { transform: scale(0.96); }

        .table-wrap {
            flex-grow: 1; overflow-y: auto; background: #000;
            border-top: 1px solid var(--border);
            -webkit-overflow-scrolling: touch;
            contain: content;
        }
        table { width: 100%; border-collapse: collapse; font-size: 12px; text-align: center; table-layout: fixed; }
        th { color: #888; padding: 8px 2px; font-weight: bold; border-bottom: 1px solid #333; font-size: 12px; position: sticky; top: 0; background: #1a1a1a; z-index: 10; }
        td { padding: 10px 2px; border-bottom: 1px solid #222; color: #ddd; }

        .win-color { color: var(--win); }
        .loss-color { color: var(--loss); }
        .wait-color { color: #888; }
        .round-score { font-weight: bold; font-size: 13px; }

    </style>
</head>
<body>

    <div id="loginLayer">
        <div class="login-box">
            <h3 style="color:var(--accent); margin-bottom:20px;">ç‹™å‡»ç³»ç»Ÿç™»å½•</h3>
            <input type="text" id="u" class="login-input" placeholder="ç”¨æˆ·å">
            <input type="password" id="p" class="login-input" placeholder="å¯†ç ">
            <button class="login-btn" onclick="tryLogin()">ç™» å½•</button>
            <div id="msg" style="color:var(--loss); font-size:12px; margin-top:10px;"></div>
        </div>
    </div>

    <div id="appLayer">
        <div class="header">
            <span class="app-title">Fibonacci Sniper v7.0</span>
            <div class="btn-group-top">
                <button class="btn-small btn-save" onclick="saveGame(true)">ä¿å­˜</button>
                <button class="btn-small btn-reset" onclick="resetGame()">é‡ç½®</button>
            </div>
        </div>

        <div class="dashboard">
            <div class="pl-display-area">
                <div class="pl-label">16ç»„çª—å£æ€»ç›ˆäº (NET P/L)</div>
                <div class="pl-value win-color" id="totalPL">+0.00</div>
            </div>

            <div class="comm-row" id="gameStatusLabel" style="color: var(--accent); font-size: 14px;">æ¸¸æˆä¸­ - è¿½è¸ªçŠ¶æ€</div>

            <div class="cum-scores-row">
                <div class="cum-item"><span class="cum-label">æ³¨ç ç­‰çº§</span><div class="cum-val-box"><span class="cum-val" id="fibLevel">0</span></div></div>
                <div class="cum-item"><span class="cum-label">ç›®æ ‡å±æ€§</span><div class="cum-val-box"><span class="cum-val" id="targetProp">-</span></div></div>
                <div class="cum-item"><span class="cum-label">è¿å‡»å±‚æ•°</span><div class="cum-val-box"><span class="cum-val" id="streakCount">0</span><span class="cum-rate">/4</span></div></div>
                <div class="cum-item"><span class="cum-label">ä¸‹æ³¨æ¬¡æ•°</span><div class="cum-val-box"><span class="cum-val" id="betCount">0</span></div></div>
            </div>

            <div class="reg-progress-area">
                <div class="reg-label-row"><span>16ç»„çª—å£è¿›åº¦ (WINDOW PROGRESS)</span><span id="regPercent">0%</span></div>
                <div class="reg-bar-bg"><div id="regFill" class="reg-bar-fill"></div></div>
            </div>

            <div class="instr-card">
                <div>
                    <div class="phase-text" id="phaseTag">ç­‰å¾…å¼€å±€ - ç¬¬ 1 ç»„ | ä½ç½® 1</div>
                    <div class="main-instr" id="mainInstr"><span id="instrDir" class="side-Wait">è§‚ æœ›</span><span id="instrAmt" style="font-size:20px; color:#fff"></span></div>
                    <div style="font-size: 10px; color: #888; margin-top: 5px;" id="instrDetail">ç­‰å¾… AA æˆ– BB è§¦å‘...</div>
                </div>
            </div>

            <div class="wl-container">
                <div class="wl-stats"><span>ä¸‹æ³¨è®°å½• (1:1èµ”ç‡)</span><span id="wlStatsText">èƒœ: 0 | è´Ÿ: 0 | èƒœç‡: 0%</span></div>
                <div class="wl-list" id="wlList"></div>
            </div>

            <div class="btn-row">
                <button class="btn-big bg-b" onclick="input('B')">å½•å…¥ 0 (åº„)</button>
                <button class="btn-big bg-p" onclick="input('P')">å½•å…¥ 1 (é—²)</button>
            </div>
            <div style="text-align:right; margin-top:5px; display: flex; justify-content: space-between; align-items: center;">
                <button class="btn-small" style="color: #666; background: transparent;" onclick="logout()">é€€å‡ºç™»å½•</button>
                <button class="btn-small" onclick="undo()">æ’¤é”€ (Undo)</button>
            </div>
        </div>

        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th width="15%">ç»„</th>
                        <th width="35%">ç»“æœ(1/2)</th>
                        <th width="25%">åŠ¨ä½œç›ˆäº</th>
                        <th width="25%">æ€»ç›ˆäº</th>
                    </tr>
                </thead>
                <tbody id="gameTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        const CRED = { u: 'jacky', p: '66620598' };
        
        // æ–æ³¢é‚£å¥‘æ³¨ç è¡¨ (æ— é™é€’å¢)
        const FIB = [1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946, 17711, 28657, 46368, 75025, 121393, 196418, 317811, 514229, 832040];

        let S = {
            group: 1,           // å½“å‰ç»„æ•° (1~16)
            hand: 1,            // ä½ç½® (1 æˆ– 2)
            history: [],        // ç»„åˆ«å†å²ï¼Œå¦‚ ['BP', 'BB']
            fibIdx: 0,          // æ³¨ç ç´¢å¼•
            streak: 0,          // å½“å‰è¿å‡»è¿›åº¦ (0, 2, 3, 4)
            targetProp: null,   // è¿½è¸ªç›®æ ‡: 'A'(å¯¹åº”åº„B/å«0), 'B'(å¯¹åº”é—²P/å«1)
            totalPL: 0,         // æ€»ç›ˆäº
            groupPL: 0,         // å½“å‰ç»„ç›ˆäº
            currentH1Res: null, // ä½ç½®1çš„ç»“æœ
            wlHistory: [],      // èƒœè´Ÿå†å² 'âœ…' / 'âŒ'
            records: [],        // è¡¨æ ¼è®°å½•
            gameStatus: 'PLAYING', // PLAYING, WON, GAMEOVER
            stack: []           // ç”¨äºæ’¤é”€
        };
        
        let isProcessing = false;

        window.onload = function() {
            if (localStorage.getItem('bacc_v7_logged_in') === 'true') {
                const sessionS = localStorage.getItem('bacc_v7_session');
                if (sessionS) S = JSON.parse(sessionS);
                enterApp();
            }
        };

        function tryLogin() {
            if(document.getElementById('u').value === CRED.u && document.getElementById('p').value === CRED.p) {
                localStorage.setItem('bacc_v7_logged_in', 'true');
                enterApp();
            } else { document.getElementById('msg').innerText = "è´¦å·æˆ–å¯†ç é”™è¯¯"; }
        }

        function enterApp() {
            document.getElementById('loginLayer').style.display = 'none';
            document.getElementById('appLayer').style.display = 'flex';
            updateUI();
        }

        function logout() {
            if(confirm("ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ")) {
                localStorage.removeItem('bacc_v7_logged_in');
                location.reload();
            }
        }

        function autoSaveSession() {
            setTimeout(() => {
                const { stack, ...dataToSave } = S; 
                localStorage.setItem('bacc_v7_session', JSON.stringify(dataToSave));
            }, 0);
        }

        // æ ¸å¿ƒï¼šåˆ¤å®šå½“å‰åŠ¨ä½œæŒ‡ä»¤
        function getInstruction() {
            if (S.gameStatus === 'WON') return { side: null, amt: 0, msg: "ğŸ¯ æ­¢ç›ˆç¦»åœºï¼4è¿å‡‘é½", detail: "æ¸¸æˆèƒœåˆ©ï¼Œè¯·é‡ç½®å¼€å¯æ–°ä¸€è½®" };
            if (S.gameStatus === 'GAMEOVER') return { side: null, amt: 0, msg: "ğŸ 16ç»„ç»“æŸ", detail: "çª—å£è€—å°½ï¼Œè¯·é‡ç½®" };
            if (S.group > 16) return { side: null, amt: 0, msg: "ç­‰å¾…é‡ç½®", detail: "-" };

            // ä¿æŠ¤ï¼šé˜²æ­¢æ³¨ç è¡¨è¶Šç•Œ
            let currentAmt = S.fibIdx < FIB.length ? FIB[S.fibIdx] : FIB[FIB.length - 1];

            if (S.targetProp) {
                // æ­£åœ¨è¿½è¸ª
                let betSide = S.targetProp === 'A' ? 'B' : 'P';
                let targetName = S.targetProp === 'A' ? 'åº„(0)' : 'é—²(1)';
                
                if (S.hand === 1) {
                    return { side: betSide, amt: currentAmt, msg: `ç‹™å‡» ${targetName}`, detail: `åš ${S.targetProp.repeat(4)} è¿å‡» (å±‚æ•°: ${S.streak}/4)` };
                } else {
                    // å¤„äºä½ç½®2ï¼Œéœ€è¦çœ‹ä½ç½®1æ˜¯å¦å·²ç»å‘½ä¸­
                    if (S.currentH1Res === betSide) {
                        return { side: null, amt: 0, msg: "è§‚ æœ› (H1å·²ä¸­)", detail: `æœ¬ç»„ç›®æ ‡å·²è¾¾æˆï¼Œéšä¾¿å½•å…¥æ¨è¿›è¿›åº¦` };
                    } else {
                        return { side: betSide, amt: currentAmt, msg: `è¿½æ‰“ ${targetName}`, detail: `H1æœªä¸­ï¼ŒH2ç»§ç»­è¿½æ‰“` };
                    }
                }
            } else {
                return { side: null, amt: 0, msg: "è§‚ æœ›", detail: "ç­‰å¾… AA æˆ– BB è§¦å‘ä¸­..." };
            }
        }

        function input(res) {
            if (isProcessing) return; 
            isProcessing = true;

            if (S.gameStatus !== 'PLAYING' && S.group > 16) {
                isProcessing = false;
                return;
            }

            // ä¿å­˜çŠ¶æ€ç”¨äºUndo
            const { stack, ...snapshotData } = S;
            S.stack.push(JSON.stringify(snapshotData));
            if (S.stack.length > 20) S.stack.shift(); 

            let instr = getInstruction();
            let actionText = "è§‚æœ›";

            // æ‰§è¡Œä¸‹æ³¨æ¸…ç®—
            if (instr.amt > 0) {
                let isWin = (instr.side === res);
                if (isWin) {
                    S.wlHistory.push('âœ…');
                    S.totalPL += instr.amt;
                    S.groupPL += instr.amt;
                } else {
                    S.wlHistory.push('âŒ');
                    S.totalPL -= instr.amt;
                    S.groupPL -= instr.amt;
                }
                S.fibIdx++; // åªè¦å‡ºæ‰‹ï¼Œå¿…å®šæ¨è¿›ä¸€æ­¥æ³¨ç 
                actionText = `æ‰“${instr.side==='B'?'0':'1'} [${instr.amt}] ${isWin?'èƒœ':'è´Ÿ'}`;
            }

            // çŠ¶æ€æœºæµè½¬
            if (S.hand === 1) {
                S.currentH1Res = res;
                S.hand = 2;
                // æ·»åŠ åŠæ¡è®°å½•ç”¨äºUIæ˜¾ç¤º
                S.records.unshift({ id: S.group, h1: res, h2: '-', action: actionText, pl: S.groupPL, totalPL: S.totalPL, isComplete: false });
            } else {
                let groupRes = S.currentH1Res + res;
                S.history.push(groupRes);

                // æ›´æ–°å®Œæ•´è®°å½•
                if(S.records.length > 0 && !S.records[0].isComplete) {
                    S.records[0].h2 = res;
                    S.records[0].action += (instr.amt>0 ? `<br>æ‰“${instr.side==='B'?'0':'1'} [${instr.amt}] ${instr.side===res?'èƒœ':'è´Ÿ'}` : `<br>è§‚æœ›`);
                    S.records[0].pl = S.groupPL;
                    S.records[0].totalPL = S.totalPL;
                    S.records[0].isComplete = true;
                }

                // --- æ ¸å¿ƒç»„é€»è¾‘åˆ¤å®š ---
                // Aå±æ€§: å«B(0); Bå±æ€§: å«P(1)
                let hasA = groupRes.includes('B');
                let hasB = groupRes.includes('P');

                if (S.targetProp) {
                    // å¤„äºè¿½è¸ªçŠ¶æ€ï¼Œæ£€éªŒç»„å±æ€§æ˜¯å¦ç»­èˆª
                    if ((S.targetProp === 'A' && hasA) || (S.targetProp === 'B' && hasB)) {
                        S.streak++;
                        if (S.streak >= 4) {
                            S.gameStatus = 'WON'; // æˆåŠŸè§¦å‘å¼ºåˆ¶æ­¢ç›ˆï¼
                        }
                    } else {
                        // é“¾æ¡æ–­è£‚ï¼Œé‡ç½®ç›®æ ‡
                        S.targetProp = null;
                        S.streak = 0;
                    }
                }

                // å¦‚æœé“¾æ¡æ–­è£‚æˆ–åŸæœ¬å°±åœ¨è§‚æœ›ï¼Œæ£€æŸ¥æ˜¯å¦äº§ç”Ÿæ–°è§¦å‘
                if (!S.targetProp && S.gameStatus === 'PLAYING' && S.history.length >= 2) {
                    let last1 = S.history[S.history.length - 1];
                    let last2 = S.history[S.history.length - 2];
                    
                    let l1A = last1.includes('B'), l2A = last2.includes('B');
                    let l1B = last1.includes('P'), l2B = last2.includes('P');

                    if (l1A && l2A) {
                        S.targetProp = 'A';
                        S.streak = 2;
                    } else if (l1B && l2B) {
                        S.targetProp = 'B';
                        S.streak = 2;
                    }
                }

                // æ¨è¿›ç»„æ•°
                S.group++;
                S.hand = 1;
                S.currentH1Res = null;
                S.groupPL = 0;

                if (S.group > 16 && S.gameStatus === 'PLAYING') {
                    S.gameStatus = 'GAMEOVER';
                }
            }
            
            autoSaveSession();
            updateUI();
            setTimeout(() => { isProcessing = false; }, 50); 
        }

        function undo() {
            if (S.stack.length > 0) {
                const lastStack = S.stack;
                S = JSON.parse(S.stack.pop());
                S.stack = lastStack;
                autoSaveSession();
                updateUI();
            }
        }

        function updateUI() {
            window.requestAnimationFrame(() => {
                const wins = S.wlHistory.filter(x => x === 'âœ…').length;
                const losses = S.wlHistory.filter(x => x === 'âŒ').length;
                const winRate = (wins + losses) > 0 ? Math.round((wins / (wins + losses)) * 100) : 0;
                
                // é¡¶éƒ¨çŠ¶æ€
                document.getElementById('totalPL').innerText = (S.totalPL > 0 ? "+" : "") + S.totalPL;
                document.getElementById('totalPL').className = S.totalPL > 0 ? 'pl-value win-color' : (S.totalPL < 0 ? 'pl-value loss-color' : 'pl-value');
                
                let statusLabel = document.getElementById('gameStatusLabel');
                if(S.gameStatus === 'WON') { statusLabel.innerText = "ğŸ‰ æŒ‘æˆ˜æˆåŠŸ - å·²è§¦å‘4è¿æ­¢ç›ˆç¦»åœº"; statusLabel.style.color = "var(--win)"; }
                else if(S.gameStatus === 'GAMEOVER') { statusLabel.innerText = "âš ï¸ æ¸¸æˆç»“æŸ - 16ç»„çª—å£è€—å°½"; statusLabel.style.color = "var(--loss)"; }
                else { statusLabel.innerText = "ğŸŸ¢ æ¸¸æˆä¸­ - åŠ¨æ€è¿½è¸ªæ¨¡å¼"; statusLabel.style.color = "var(--accent)"; }

                // ä»ªè¡¨ç›˜æ•°æ®
                document.getElementById('fibLevel').innerText = S.fibIdx;
                document.getElementById('targetProp').innerText = S.targetProp ? (S.targetProp==='A'?'A (æ‰“0)':'B (æ‰“1)') : "æ— ";
                document.getElementById('targetProp').className = S.targetProp ? (S.targetProp==='A'?'cum-val side-B':'cum-val side-P') : 'cum-val wait-color';
                document.getElementById('streakCount').innerText = S.streak;
                document.getElementById('streakCount').className = S.streak >= 4 ? 'cum-val win-color' : 'cum-val';
                document.getElementById('betCount').innerText = (wins + losses);

                // è¿›åº¦æ¡ (åŸºäº16ç»„çª—å£)
                let progress = Math.min((S.group - 1 + (S.hand===2?0.5:0)) / 16 * 100, 100);
                document.getElementById('regFill').style.width = progress + '%';
                document.getElementById('regPercent').innerText = Math.floor(progress) + '%';

                document.getElementById('wlStatsText').innerText = `èƒœ: ${wins} | è´Ÿ: ${losses} | èƒœç‡: ${winRate}%`;
                const wlList = document.getElementById('wlList');
                wlList.innerHTML = S.wlHistory.map(item => `<span class="${item==='âœ…'?'wl-item-win':'wl-item-loss'}">${item}</span>`).join('');
                wlList.scrollTop = wlList.scrollHeight;

                // æŒ‡ä»¤åŒºæ¸²æŸ“
                let instr = getInstruction();
                document.getElementById('phaseTag').innerText = `ç¬¬ ${Math.min(S.group, 16)} ç»„ | ä½ç½® ${S.hand}`;
                
                let dir = document.getElementById('instrDir');
                if (instr.amt === 0) { 
                    dir.innerText = instr.msg; 
                    dir.className = "side-Wait"; 
                    document.getElementById('instrAmt').innerText = ""; 
                } else {
                    dir.innerText = instr.side === 'B' ? "åº„(0)" : "é—²(1)";
                    dir.className = instr.side === 'B' ? "side-B" : "side-P";
                    document.getElementById('instrAmt').innerText = instr.amt;
                }
                document.getElementById('instrDetail').innerText = instr.detail;

                // å†å²è¡¨æ ¼æ¸²æŸ“
                let html = "";
                for(let i=0; i<S.records.length; i++) {
                    let rec = S.records[i];
                    html += `<tr>
                        <td>G${rec.id}</td>
                        <td style="font-weight:bold; color:#fff">${rec.h1 === 'B' ? '0' : (rec.h1 === 'P' ? '1' : '-')} , ${rec.h2 === 'B' ? '0' : (rec.h2 === 'P' ? '1' : '-')}</td>
                        <td class="${rec.pl>0?'win-color':(rec.pl<0?'loss-color':'wait-color')}" style="font-size:11px">${rec.action || '-'}</td>
                        <td class="${rec.totalPL>0?'win-color':(rec.totalPL<0?'loss-color':'wait-color')}" style="font-weight:bold">${rec.totalPL>0?'+':''}${rec.totalPL}</td>
                    </tr>`;
                }
                document.getElementById('gameTable').innerHTML = html;
            });
        }

        function saveGame(showMsg=false) {
            const { stack, ...saveData } = S;
            let saveObj = { id: Date.now(), date: new Date().toLocaleString(), finalPL: S.totalPL, group: S.group, state: saveData };
            let hist = JSON.parse(localStorage.getItem('bacc_v7_hist')||'[]');
            hist.unshift(saveObj);
            localStorage.setItem('bacc_v7_hist', JSON.stringify(hist.slice(0, 50)));
            if(showMsg) alert("ä¿å­˜æˆåŠŸï¼");
        }
        function resetGame() { 
            if(confirm("ç¡®å®šè¦é‡ç½®å¹¶å¼€å¯æ–°çš„16ç»„çª—å£å—ï¼Ÿ")) { 
                localStorage.removeItem('bacc_v7_session'); 
                location.reload(); 
            } 
        }
    </script>
</body>
</html>
